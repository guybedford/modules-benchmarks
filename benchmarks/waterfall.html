<!doctype html>
<script type="module">
  import { start, stop } from '/bench.js';

  const { d = 8 } = Object.fromEntries(new URL(location.href).searchParams);

  const iframe = Object.assign(document.createElement('iframe'), { style: 'display: none' });

  iframe.srcdoc = `\
<script type="module">
  import(\`https://localhost:8000/generated/app.waterfall${d}.js\`).then(parent._done);
<${''}/script>
`;

  const donePromise = new Promise(resolve => self._done = resolve);

  start();
  document.body.appendChild(iframe);
  donePromise.then(stop);
</script>
